<script type="text/javascript">
    RED.nodes.registerType('pdfmake', {
        category: "advanced",
        color: "rgb(222, 189, 92)",
        icon: "font-awesome/fa-file-pdf-o",
        defaults: {
            name: { value: "" },
            outputType: {value: "base64"},
            inputProperty: {value: "payload"},
            options: {value: "{}"},
            outputProperty: {value: "payload"},
        },
        label: function () {
            return this.name || "pdfmake";
        },
        inputs: 1,
        outputs: 1,
        paletteLabel: "pdfmake",
        oneditprepare: function () {
            this.editor = RED.editor.createEditor({
                id: 'node-description-editor',
                mode: 'ace/mode/markdown',
                value: $("#node-input-info").val()
            });

            let config = this;
            $("#node-input-outputType").append($("<option></option>").attr("value", "base64").text("base64"));;
            $("#node-input-outputType").append($("<option></option>").attr("value", "Buffer").text("Buffer"));;
            $("#node-input-outputType").val(config.outputType);

            $("#node-input-inputProperty").typedInput({
                default: "msg",
                types: ["msg","global", "flow", "json", "jsonata"]
            });
            $("#node-input-options").typedInput({
                default: "json",
                types: ["msg","global", "flow", "json", "jsonata"]
            });
            $("#node-input-outputProperty").typedInput({
                default: "msg",
                types: ["msg","global", "flow"]
            });

        },
        oneditsave: function () {
            // save parameter sources for selected component
            $("#node-input-info").val(this.editor.getValue());
            // get target node ID
            this.outputType = $("#node-input-outputType").children("option:selected").val();
            this.inputProperty = $("#node-input-inputProperty").typedInput("value");
            this.options = $("#node-input-options").typedInput("value");
            this.outputProperty = $("#node-input-outputProperty").typedInput("value");
        }
	});
</script>
<script type="text/x-red" data-template-name="pdfmake">
    <div class="form-row">
        <label for="node-input-name" ><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-inputProperty"><i class="fa fa-ellipsis-h"></i> <span data-i18n="pdfmake.label.inputProperty"></span></label>
        <input id="node-input-inputProperty">
    </div>
    <div class="form-row">
        <label for="node-input-options"><i class="fa fa-code"></i> <span data-i18n="pdfmake.label.options"></span></label>
        <input id="node-input-options">
    </div>
    <div class="form-row">
        <label for="node-input-outputType"><i class="fa fa-sign-out"></i> <span data-i18n="pdfmake.label.outputType"></span></label>
        <select id="node-input-outputType"></select>
    </div>
    <div class="form-row">
        <label for="node-input-outputProperty"><i class="fa fa-sign-out"></i> <span data-i18n="pdfmake.label.outputProperty"></span></label>
        <input id="node-input-outputProperty">
    </div>
  </script>
  <script type="text/html" data-help-name="pdfmake">
    <p>Produces a PDF using <a href="https://pdfmake.github.io/docs/" target="blank">pdfmake</a></p>
    
    <h3>Inputs</h3>
        <dl class="message-properties">
            <dt>payload
                <span class="property-type">json</span>
            </dt>
            <dd> the <a href="https://pdfmake.github.io/docs/document-definition-object/">document definition</a> of the PDF to create. </dd>
            <dt class="optional">options <span class="property-type">json</span></dt>
            <dd> options as defined <a href="https://pdfmake.github.io/docs/options/">here</a></dd>
        </dl>
    
     <h3>Outputs</h3>
         <ol class="node-ports">
             <li>PDF
                 <dl class="message-properties">
                     <dt>payload <span class="property-type">base64 encoded string |Â buffer</span></dt>
                     <dd>the PDF in the selected format</dd>
                 </dl>
             </li>
         </ol>
    
    <h3>Details</h3>
        <p><code>msg.payload</code> is used as the document definition for the result PDF.
        The node expects an object in the format defined <a href="https://pdfmake.github.io/docs/document-definition-object/">here</a>.
        </p>
        <p>Take a look at the examples provided by this node:
            <ul>
                <li>simple pdf - the first, simple example with two paragraphs</li>
                <li>image svg pdf - a PDF with an image from file and a SVG. Needs node-red-node-base64!</li>
            </ul>
            Or surf <a href="http://pdfmake.org/playground.html">here</a> for more examples.
        </p>
    
    </script>